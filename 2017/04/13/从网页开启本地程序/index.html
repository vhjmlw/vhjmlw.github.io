<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>从网页开启本地程序 | 建磊的博客</title>
  <meta name="author" content="建磊">
  
  <meta name="description" content="使用URL Protocol自定义协议，从网页开启Windows操作系统的本地程序">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="从网页开启本地程序"/>
  <meta property="og:site_name" content="建磊的博客"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="建磊的博客" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">建磊的博客</a></h1>
  <h2><a href="/">爱钻研，爱技术；同时爱电影，爱音乐。</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-04-13T13:22:22.000Z"><a href="/2017/04/13/从网页开启本地程序/">2017-04-13</a></time>
      
      
  
    <h1 class="title">从网页开启本地程序</h1>
  

    </header>
    <div class="entry">
      
        <p>使用URL Protocol自定义协议，从网页开启Windows操作系统的本地程序<br><a id="more"></a></p>
<h3 id="使用URL-Protocol自定义协议，从网页开启Windows操作系统本地程序"><a href="#使用URL-Protocol自定义协议，从网页开启Windows操作系统本地程序" class="headerlink" title="使用URL Protocol自定义协议，从网页开启Windows操作系统本地程序"></a>使用URL Protocol自定义协议，从网页开启Windows操作系统本地程序</h3><p>参考链接：<br><a href="https://wenku.baidu.com/view/29510d746bd97f192279e9cd.html" target="_blank" rel="external">https://wenku.baidu.com/view/29510d746bd97f192279e9cd.html</a><br><a href="https://sspai.com/post/31500" target="_blank" rel="external">https://sspai.com/post/31500</a>   </p>
<h5 id="以下方法知识针对Windows操作系统，其他系统未经测试。"><a href="#以下方法知识针对Windows操作系统，其他系统未经测试。" class="headerlink" title="以下方法知识针对Windows操作系统，其他系统未经测试。"></a>以下方法知识针对Windows操作系统，其他系统未经测试。</h5><p>有很多场景，如：我们在浏览网页的时候，点击网页上的某个按钮就可以开启迅雷下载资源、开启一个QQ或者旺旺对话框并同时定位到聊天对象。这些场景下，都是通过网页来开启本地的一个应用程序。如：</p>
<p><img src="http://i2.muimg.com/567571/79b190605477f625.png" alt=""></p>
<p>实现该效果的原理非常简单：使用外部协议（自定义协议）<code>URL Protocol</code>，通过写注册表将url与本地应用程序关联，然后通过一个网页的超链接点击即可启动，<strong>如果浏览器不识别我们自定义的协议，就会查找注册表，启动与我们自定义的协议相关联的本地的应用程序，并传递参数</strong>。</p>
<p>恰巧最近的一个项目中有类似的需求，就把整个折腾的过程记录下来，梳理下实现的过程。<br>下面就以点击页面上的按钮开启本地的sublime text编辑器为例。</p>
<h4 id="在注册表中建立本地程序（sublime-text）和自定义协议的关联："><a href="#在注册表中建立本地程序（sublime-text）和自定义协议的关联：" class="headerlink" title="在注册表中建立本地程序（sublime text）和自定义协议的关联："></a>在注册表中建立本地程序（sublime text）和自定义协议的关联：</h4><ol>
<li><p>使用win+R快捷键，开启Windows操作系统的<code>运行</code>窗口，在窗口中输入<code>regedit</code>打开注册表编辑器。</p>
<p><img src="http://i2.muimg.com/567571/0f514b98dc11167a.png" alt=""><br><img src="http://i2.muimg.com/567571/ef3b0d2fac2d4304.png" alt=""></p>
</li>
<li><p>在<code>HKEY_CLASSES_ROOT</code>下面新建一个我们自定义的协议名称<code>sublime</code>，该协议名称可以自定义（右键-新建-项-输入sublime）。然后在sublime下面新建项<code>DefaultIcon</code>和<code>shell</code>，在shell下面新建项<code>open</code>，在open下面新建项<code>command</code>。此时我们自定义的协议结构已经完成，整个结构是这样的：</p>
<p><img src="http://i4.buimg.com/567571/7df33cd55b43c877.png" alt=""></p>
<p>接下来开始设置每一项对应的值。    </p>
</li>
<li><p>首先设置<code>sublime</code>的值：（默认）值可以省略，点击网页按钮弹出alert对话框时会显示该值，这里我们将值设置为<code>URL：sublime专用链接</code>。新建一个字符串值<code>URL Protocol</code>，值可以省略。<br>效果如下：</p>
<p><img src="http://i2.muimg.com/567571/0aa0208433bcbce0.png" alt=""></p>
<p>然后设置<code>DefaultIcon</code>项的值：将（默认）值设置为我们要与自定义协议关联的本地程序（只能是exe扩展名）的绝对路径，我们这里是sublime的绝对路径，路径后面跟着参数（该参数的意义暂时未知，貌似也可以省略）。<br>效果如下：</p>
<p><img src="http://i2.muimg.com/567571/6848c9a22e224343.png" alt=""></p>
<p>最后设置<code>command</code>项的值：同样将（默认）值设置为我们要启动的本地程序的绝对路径+参数。这里<code>%1</code>就是传递给 exe文件的参数，exe文件接收该参数并执行，如果web网页中的超链接代码为<code>调用远程监控</code>，那么%1这个参数就是<code>“sublime://调用远程监控”</code>字符串。<br>关于参数，sublime://后面的字符串被看作参数，有两种，一种是0，表示完整执行路径，另一种是1，表示网页传过来的字符串。<br>效果如下：</p>
<p><img src="http://i2.muimg.com/567571/8b9714d667b99458.png" alt=""></p>
<p>到目前为止，我们在注册表中将本地程序和自定义协议建立关联的步骤已经完成了。</p>
</li>
</ol>
<blockquote>
<p>迅雷、QQ、旺旺等程序在软件安装的时候，就已经把我们以上建立关联的步骤自动完成了，不需要我们手动操作。</p>
</blockquote>
<h4 id="在网页中使用我们自定义的协议开启本地程序"><a href="#在网页中使用我们自定义的协议开启本地程序" class="headerlink" title="在网页中使用我们自定义的协议开启本地程序"></a>在网页中使用我们自定义的协议开启本地程序</h4><p>当点击网页上的<code>点击开启sublime</code>标签时，浏览器就会弹出一个对话框，询问是否同意开启sublime本地程序，点击打开，此时就会打开sublime程序。</p>
<p><img src="http://i4.buimg.com/567571/cbef3d1121a74558.png" alt=""><br><img src="http://i4.buimg.com/567571/fda3347b5f902a52.png" alt=""></p>
<p>目前为止，我们已经实现了从网页开启本地程序的功能，使用URL Protocol的时候也可以传递参数给本地程序，本地程序接收到参数之后可以进一步进行处理，实现更加丰富的功能，如点击迅雷下载，可以下载指定的资源；点击QQ聊天可以打开聊天窗口，并定位到指定的QQ号码。</p>
<p>这里URL Protocol传参的内容暂时就不做介绍，以后补充。</p>
<blockquote>
<p>关于使用Markdown时导入本地图片的问题，目前为止还没有特别好的解决办法，可以使用新浪、QQ空间的图床功能，也可以使用base64转换，但都不是特别好，这是使用的是<a href="http://jiantuku.com" target="_blank" rel="external">极简图床</a>提供的服务，免费快速方便，是还不错的解决方案。</p>
</blockquote>

      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">留言</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://vhjmlw.github.io/2017/04/13/从网页开启本地程序/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:vhjmlw.github.io">
  </form>
</div>

  

  
</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 建磊
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
